webpackJsonp([4],{"8aYR":function(e,t){},hJGy:function(e,t){},ixFx:function(e,t){},l2LT:function(e,t){},m9Po:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("mvHQ"),a=r.n(s),n=r("Xxa5"),i=r.n(n),l=r("exGp"),o=r.n(l),c=r("Dd8w"),u=r.n(c),d=r("NYxO"),m={props:{name:String,avatar:String}},f={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"wl-avatar"},[this.avatar?t("span",{staticClass:"icon"},[t("img",{attrs:{src:this.avatar}})]):this._e(),this._v(" "),t("span",[this._v(this._s(this.name))])])},staticRenderFns:[]};var p=r("VU/8")(m,f,!1,function(e){r("ixFx")},null,null).exports,v=r("bZyb"),b=r("4MTg"),h={props:{visible:{type:Boolean,default:!1},user:Object},data:function(){return{roles:v.b,error:this.initError(),form:this.initForm(0),updatePasswordRules:[{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{6,}$/,message:"至少6个字符，至少1个大写字母，1个小写字母和1个数字",trigger:"blur"}],rules:{email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请设置密码",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[\s\S]{6,}$/,message:"至少6个字符，至少1个大写字母，1个小写字母和1个数字",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}]}}},watch:{visible:{immediate:!0,handler:function(e){var t=this;if(e){if(this.user){var r=this.user,s=r.username,a=r.email,n=r.password;this.form.username=s,this.form.email=a,this.form.password=n}else this.form=this.initForm();this.$nextTick(function(){t.$refs.form&&t.$refs.form.clearValidate()})}}}},computed:{isNew:function(){return!this.user}},methods:{onOk:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.sendData()})},onCancel:function(){this.$emit("update:visible"),this.$emit("close")},initForm:function(){return{email:"",password:"",username:""}},initError:function(){return{email:"",password:"",username:""}},sendData:function(){var e=this;return o()(i.a.mark(function t(){var r,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.error=e.initError(),t.t0=e.isNew,!t.t0){t.next=6;break}return t.next=6,Object(b.b)(e.form);case 6:if(t.t1=e.isNew,t.t1){t.next=10;break}return t.next=10,Object(b.j)(e.user.id,e.form);case 10:e.$emit("update:visible"),e.$emit("confirm"),t.next=19;break;case 14:if(t.prev=14,t.t2=t.catch(0),t.t2.code,r=t.t2.message)for(s in r)e.error[s]=r[s][0];case 19:case"end":return t.stop()}},t,e,[[0,14]])}))()}}},w={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{staticClass:"wl-add-user",attrs:{width:"600px",title:e.isNew?"新增用户":"编辑用户",visible:e.visible,"before-close":e.onCancel,"close-on-click-modal":!1,"append-to-body":!0}},[r("el-form",{ref:"form",attrs:{model:e.form}},[r("el-form-item",{attrs:{label:"用户名","label-width":"120px",prop:"username",rules:e.rules.username,error:e.error.username}},[r("el-input",{attrs:{size:"small","auto-complete":"off"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱","label-width":"120px",prop:"email",rules:e.isNew?e.rules.email:[],error:e.error.email}},[r("el-input",{attrs:{size:"small","auto-complete":"off",disabled:!e.isNew},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"密码","label-width":"120px",prop:"password",rules:e.isNew?e.rules.password:e.updatePasswordRules,error:e.error.password}},[r("el-input",{attrs:{size:"small",type:"password","auto-complete":"off"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onOk}},[e._v("确定")]),e._v(" "),r("el-button",{attrs:{size:"small"},on:{click:e.onCancel}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var g=r("VU/8")(h,w,!1,function(e){r("8aYR")},null,null).exports,x=r("ArRN"),k={props:{visible:{type:Boolean,default:!1},user:Object,spaceId:[String,Number]},data:function(){return{roles:v.c,form:this.initForm()}},watch:{visible:{immediate:!0,handler:function(e){e&&this.user&&(this.form.role=this.user.role||"")}}},methods:{onOk:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.sendData()})},onCancel:function(){this.$emit("update:visible"),this.$emit("close")},initForm:function(){return{role:""}},sendData:function(){var e=this;return o()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(x.h)(e.spaceId,u()({},e.user,{role:e.form.role}));case 2:e.$message({type:"success",message:"修改成功"}),e.$emit("update:visible"),e.$emit("confirm");case 5:case"end":return t.stop()}},t,e)}))()}}},_={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{staticClass:"wl-edit-user",attrs:{width:"600px",title:"编辑用户",visible:e.visible,"close-on-click-modal":!1,"before-close":e.onCancel,"append-to-body":!0}},[r("el-form",{ref:"form",attrs:{model:e.form}},[r("el-form-item",{attrs:{label:"成员角色"}},[r("el-select",{style:{width:"400px"},attrs:{size:"small",placeholder:"请选择角色"},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},e._l(e.roles,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:t}})}))],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onOk}},[e._v("确定")]),e._v(" "),r("el-button",{attrs:{size:"small"},on:{click:e.onCancel}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var $=r("VU/8")(k,_,!1,function(e){r("l2LT")},null,null).exports,y={name:"user-list",mixins:[r("3HZp").a],components:{addUserDialog:g,editUserDialog:$},data:function(){return{enableCreate:!1,value:"",columns:function(){var e=this;return[{label:"用户名",width:200,prop:"username",render:function(e,t){return e(p,{attrs:{name:t.row.username,avatar:t.row.avatar}})}},{label:"邮箱",width:200,prop:"email"},{label:"状态",width:100,prop:"status"},{label:"角色",width:150,render:function(e,t){return v.b[t.row.role]}},{label:"操作",minWidth:200,render:function(t,r,s){return e.renderTools(r)}}]}.call(this),currentEditUser:null,addUserDialogVisible:!1,editUserDialogVisible:!1,spaceAllData:null}},watch:{value:function(){this.search()}},computed:u()({},Object(d.c)(["spaceId","isSuper"])),created:function(){var e=this;return o()(i.a.mark(function t(){var r,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.spaceId){t.next=6;break}return t.next=3,Object(x.c)(e.spaceId);case 3:r=t.sent,s=r.data,e.spaceAllData=s;case 6:case"end":return t.stop()}},t,e)}))()},methods:{callServe:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$refs.table;return o()(i.a.mark(function r(){var s,a,n,l,o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.isSuper){r.next=6;break}return r.next=3,Object(b.f)({size:t.page.size,page:t.page.currentPage,kw:e.value});case 3:r.t0=r.sent,r.next=9;break;case 6:return r.next=8,Object(x.d)(e.spaceId,{size:t.page.size,page:t.page.currentPage,kw:e.value});case 8:r.t0=r.sent;case 9:s=r.t0,a=s.data,n=a.list,l=a.count,o=a.enable_create,e.enableCreate=o,t.page.total=l,t.list=n;case 17:case"end":return r.stop()}},r,e)}))()},search:function(){this.callServe()},getAllMembers:function(){var e=this;return o()(i.a.mark(function t(){var r,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(x.c)(e.spaceId);case 2:r=t.sent,s=r.data,e.spaceAllData=s;case 5:case"end":return t.stop()}},t,e)}))()},addMember:function(e){var t=this;return o()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(x.g)(t.spaceId,u()({},t.spaceAllData,{members:a()([].concat(t.spaceAllData.members,[e]))}));case 2:t.getAllMembers(),t.callServe(),t.$message({type:"success",message:"添加成功!"});case 5:case"end":return r.stop()}},r,t)}))()},addUser:function(){this.addUserDialogVisible=!0},edit:function(e){this.isSuper?this.addUserDialogVisible=!0:this.editUserDialogVisible=!0,this.currentEditUser=u()({},e)},lock:function(e){var t=this;return o()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("正常"!==e.status){r.next=5;break}return r.next=3,Object(b.c)(e.id);case 3:r.next=8;break;case 5:if(2!==e.status){r.next=8;break}return r.next=8,Object(b.a)(e.id);case 8:t.callServe();case 9:case"end":return r.stop()}},r,t)}))()},delete:function(e){var t=this;this.$confirm("确定删除该用户吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.deleteUser(e)}).catch(function(){})},deleteUser:function(e){var t=this;return o()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(b.d)(e.id);case 2:t.callServe(),t.$message({type:"success",message:"删除成功!"});case 4:case"end":return r.stop()}},r,t)}))()},confirm:function(e){this.currentEditUser=null,this.callServe()},close:function(){this.currentEditUser=null},renderEditTool:function(e){var t=this,r=this.$createElement;return e.enable_update?r("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(){return t.edit(u()({},e))}}},["编辑"]):null},renderDeleteTool:function(e){var t=this,r=this.$createElement;return e.enable_delete?r("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-delete"},class:"user-delete",on:{click:function(){return t.delete(u()({},e))}}},["删除"]):null},renderBlockTool:function(e){var t=this,r=this.$createElement;return e.enable_block?r("el-button",{attrs:{type:"text",size:"small",icon:"wl-icon-lock"},on:{click:function(){return t.lock(u()({},e))}}},["正常"===e.status?"冻结":"激活"]):null},renderTools:function(e){return(0,this.$createElement)("div",[this.renderEditTool(e.row),this.renderDeleteTool(e.row),this.renderBlockTool(e.row)])}}},U={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"wl-user-list"},[e.isSuper?r("el-form",{attrs:{inline:!0},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{staticClass:"search",attrs:{placeholder:"请输入内容",size:"small"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1),e._v(" "),e.enableCreate?r("el-form-item",[r("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit"},on:{click:e.addUser}},[e._v("新建")])],1):e._e()],1):e._e(),e._v(" "),e.isSuper?e._e():r("div",{staticClass:"wl-user-list__wrap"},[e.enableCreate?r("add-member",{on:{add:e.addMember}}):e._e(),e._v(" "),r("el-input",{staticClass:"no-super-search",attrs:{placeholder:"请输入内容",size:"small"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1),e._v(" "),e.enableCreate?r("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit"},on:{click:e.addUser}},[e._v("新建")]):e._e()],1),e._v(" "),r("wl-table",{ref:"table",attrs:{columns:e.columns},on:{callServe:e.callServe}}),e._v(" "),r("add-user-dialog",{attrs:{visible:e.addUserDialogVisible,user:e.currentEditUser},on:{"update:visible":function(t){e.addUserDialogVisible=t},confirm:e.confirm,close:e.close}}),e._v(" "),r("edit-user-dialog",{attrs:{visible:e.editUserDialogVisible,spaceId:e.spaceId,user:e.currentEditUser},on:{"update:visible":function(t){e.editUserDialogVisible=t},confirm:e.confirm,close:e.close}})],1)},staticRenderFns:[]};var D=r("VU/8")(y,U,!1,function(e){r("hJGy")},null,null);t.default=D.exports}});